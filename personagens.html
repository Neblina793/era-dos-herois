<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personagens - Era dos Her√≥is</title>
  <style>
    :root {
      --bg-body: #0b0b0f;
      --bg-card: #16161e;
      --gold: #d4af37;
      --primary-color: #e63946;
      --text-main: #eee;
      --text-muted: #aaa;
      --border-color: #333;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    .container { width: 100%; max-width: 800px; }

    header { text-align: center; margin-bottom: 20px; width: 100%; }
    header h1 { color: var(--gold); margin: 0; }

    nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; }
    nav a { 
      border: 1px solid var(--gold); color: var(--gold); 
      padding: 8px 14px; text-decoration: none; transition: 0.3s;
      border-radius: 4px;
    }
    nav a:hover { background: var(--gold); color: #000; }

    h2 { color: var(--gold); text-align: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }

    .lista-nomes { list-style: none; padding: 0; }
    .item-personagem {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      margin-bottom: 8px;
      padding: 15px;
      border-radius: 4px;
      cursor: pointer;
      transition: 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item-personagem:hover { border-color: var(--gold); background: #1f1f2a; }
    .item-personagem strong { color: var(--gold); font-size: 1.1em; }

    #detalhesFicha {
      display: none;
      background: var(--bg-card);
      border: 2px solid var(--gold);
      padding: 25px;
      border-radius: 8px;
      margin-top: 20px;
      position: relative;
    }

    .btn-fechar {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 4px;
      font-weight: bold;
    }

    .ficha-header { border-bottom: 1px solid var(--gold); margin-bottom: 15px; padding-bottom: 10px; }
    .ficha-subtitle { color: var(--text-muted); font-size: 0.9em; margin-top: 5px; }

    .grid-combat { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 15px 0; text-align: center; }
    @media (max-width: 600px) { .grid-combat { grid-template-columns: repeat(3, 1fr); } }

    .stat-box { background: #0b0b0f; padding: 10px; border-radius: 4px; border: 1px solid #333; }
    .stat-box small { color: var(--gold); display: block; font-size: 0.7em; text-transform: uppercase; margin-bottom: 4px; }
    .stat-box b { font-size: 1.3em; display: block; }

    .grid-attr { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin-bottom: 20px; text-align: center; }
    @media (max-width: 600px) { .grid-attr { grid-template-columns: repeat(3, 1fr); } }

    .attr-box { background: #222; padding: 8px; border-radius: 4px; border: 1px solid #444; }
    .attr-box span { color: var(--gold); font-weight: bold; font-size: 0.8em; display: block; }
    .attr-box div { font-size: 1.2em; font-weight: bold; margin: 2px 0; }
    .attr-box sub { color: #888; font-size: 0.9em; font-weight: normal; }

    .secao-texto { background: #111; padding: 15px; border-radius: 4px; margin-top: 15px; border-left: 4px solid var(--gold); }
    .secao-texto h4 { color: var(--gold); margin: 0 0 8px 0; font-size: 1em; text-transform: uppercase; letter-spacing: 1px; }
    .secao-texto p { white-space: pre-wrap; margin: 0; color: #ddd; font-size: 0.95em; line-height: 1.4; font-family: 'Segoe UI', sans-serif; }
    
    .xp-badge { background: #333; color: var(--gold); padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 10px; vertical-align: middle; }
    .vazio { text-align: center; color: #666; margin-top: 40px; }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>Era dos Her√≥is</h1>
  </header>

  <nav>
    <a href="index.html">In√≠cio</a>
    <a href="criar.html">Criar Personagem</a>
    <a href="personagens.html">Ver Personagens</a>
  </nav>

  <div id="areaLista">
    <h2>Meus Personagens</h2>
    <ul id="listaNomes" class="lista-nomes"></ul>
  </div>

  <div id="detalhesFicha">
    <button class="btn-fechar" onclick="fecharFicha()">Sair</button>
    <div id="conteudoFicha"></div>
  </div>
</div>

<script>
  // Chave sincronizada com criar.html
  const STORAGE_KEY = 'rpg_sheets_v4';
  let fichas = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

  function renderizarLista() {
    const lista = document.getElementById('listaNomes');
    lista.innerHTML = '';

    if (fichas.length === 0) {
      lista.innerHTML = '<p class="vazio">Nenhuma ficha salva. Crie um personagem primeiro!</p>';
      return;
    }

    fichas.forEach((p, index) => {
      const li = document.createElement('li');
      li.className = 'item-personagem';
      li.innerHTML = `
        <div>
          <strong>${p.nome}</strong><br>
          <small style="color:#888">${p.raca} ${p.classe} - Nvl ${p.nivel}</small>
        </div>
        <span style="color:var(--gold)">Abrir Ficha ‚Üí</span>
      `;
      li.onclick = () => verFicha(index);
      lista.appendChild(li);
    });
  }

  function verFicha(index) {
    const p = fichas[index];
    const areaLista = document.getElementById('areaLista');
    const areaFicha = document.getElementById('detalhesFicha');
    const conteudo = document.getElementById('conteudoFicha');

    const mod = (val) => {
      let v = parseInt(val) || 10;
      let m = Math.floor((v - 10) / 2);
      return m >= 0 ? '+' + m : m;
    };

    let divindadesInfo = p.divindade ? `Devoto de: ${p.divindade}` : '';
    if (p.divindade_menor) divindadesInfo += ` (Menor: ${p.divindade_menor})`;

    conteudo.innerHTML = `
      <div class="ficha-header">
        <h1 style="margin:0; color:var(--gold); display:inline-block;">${p.nome}</h1>
        <span class="xp-badge">${p.xp || '0'} XP</span>
        <div style="font-size: 1.2em; color: white; margin-top:5px;">
          ${p.raca} ${p.classe} <span style="color:var(--gold)">| N√≠vel ${p.nivel}</span>
        </div>
        ${divindadesInfo ? `<div class="ficha-subtitle">${divindadesInfo}</div>` : ''}
      </div>

      <div class="grid-combat">
        <div class="stat-box"><small>PV M√°x</small><b>${p.hp}</b></div>
        <div class="stat-box"><small>CA</small><b>${p.ca}</b></div>
        <div class="stat-box"><small>Iniciativa</small><b>${p.iniciativa || '+0'}</b></div>
        <div class="stat-box"><small>Desloc.</small><b>${p.speed || '9m'}</b></div>
        <div class="stat-box"><small>Percep√ß√£o</small><b>${p.percepcao || '10'}</b></div>
      </div>

      <div class="grid-attr">
        <div class="attr-box"><span>FOR</span><div>${p.stats.for}</div><sub>${mod(p.stats.for)}</sub></div>
        <div class="attr-box"><span>DES</span><div>${p.stats.des}</div><sub>${mod(p.stats.des)}</sub></div>
        <div class="attr-box"><span>CON</span><div>${p.stats.con}</div><sub>${mod(p.stats.con)}</sub></div>
        <div class="attr-box"><span>INT</span><div>${p.stats.int}</div><sub>${mod(p.stats.int)}</sub></div>
        <div class="attr-box"><span>SAB</span><div>${p.stats.sab}</div><sub>${mod(p.stats.sab)}</sub></div>
        <div class="attr-box"><span>CAR</span><div>${p.stats.car}</div><sub>${mod(p.stats.car)}</sub></div>
      </div>

      ${p.desc_armadura ? `
      <div class="secao-texto">
        <h4>üõ°Ô∏è Equipamento Defensivo</h4>
        <p>${p.desc_armadura}</p>
      </div>` : ''}

      ${p.talentos ? `
      <div class="secao-texto">
        <h4>‚≠ê Talentos e Feitos</h4>
        <p>${p.talentos}</p>
      </div>` : ''}

      <div class="secao-texto">
        <h4>üìú Habilidades de Classe/Ra√ßa</h4>
        <p>${p.habilidades || 'Nenhuma habilidade registrada.'}</p>
      </div>

      ${p.magias ? `
      <div class="secao-texto">
        <h4>üîÆ Livro de Magias / Preces</h4>
        <p>${p.magias}</p>
      </div>` : ''}

      <div class="secao-texto">
        <h4>üéí Invent√°rio e Itens</h4>
        <p>${p.inventario || 'Nenhum item carregado.'}</p>
      </div>
    `;

    areaLista.style.display = 'none';
    areaFicha.style.display = 'block';
    window.scrollTo(0,0);
  }

  function fecharFicha() {
    document.getElementById('areaLista').style.display = 'block';
    document.getElementById('detalhesFicha').style.display = 'none';
  }

  renderizarLista();
</script>

</body>
</html>